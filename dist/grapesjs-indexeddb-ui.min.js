/*! grapesjs-indexeddb-ui - 1.0.4 */
!function(e,t){'object'==typeof exports&&'object'==typeof module?module.exports=t():'function'==typeof define&&define.amd?define([],t):'object'==typeof exports?exports["grapesjs-indexeddb-ui"]=t():e["grapesjs-indexeddb-ui"]=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&'object'==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,'default',{enumerable:!0,value:e}),2&t&&'string'!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,'a',t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){!function(t){'use strict';var n=function(){return{escape:function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,'\\$1')},parseExtension:t,mimeType:function(e){var n=t(e).toLowerCase();return(r='application/font-woff',{woff:r,woff2:r,ttf:'application/font-truetype',eot:'application/vnd.ms-fontobject',png:'image/png',jpg:"image/jpeg",jpeg:"image/jpeg",gif:'image/gif',tiff:'image/tiff',svg:'image/svg+xml'})[n]||'';var r},dataAsUrl:function(e,t){return'data:'+t+';base64,'+e},isDataUrl:function(e){return-1!==e.search(/^(data:)/)},canvasToBlob:function(e){return e.toBlob?new Promise((function(t){e.toBlob(t)})):function(e){return new Promise((function(t){for(var n=window.atob(e.toDataURL().split(',')[1]),r=n.length,o=new Uint8Array(r),i=0;i<r;i++)o[i]=n.charCodeAt(i);t(new Blob([o],{type:'image/png'}))}))}(e)},resolveUrl:function(e,t){var n=document.implementation.createHTMLDocument(),r=n.createElement('base');n.head.appendChild(r);var o=n.createElement('a');return n.body.appendChild(o),r.href=t,o.href=e,o.href},getAndEncode:function(e){c.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());return new Promise((function(t){var n,r=new XMLHttpRequest;if(r.onreadystatechange=function(){if(4!==r.readyState)return;if(200!==r.status)return void(n?t(n):i('cannot fetch resource: '+e+', status: '+r.status));var o=new FileReader;o.onloadend=function(){var e=o.result.split(/,/)[1];t(e)},o.readAsDataURL(r.response)},r.ontimeout=function(){n?t(n):i("timeout of 30000ms occured while fetching resource: "+e)},r.responseType='blob',r.timeout=3e4,r.open('GET',e,!0),r.send(),c.impl.options.imagePlaceholder){var o=c.impl.options.imagePlaceholder.split(/,/);o&&o[1]&&(n=o[1])}function i(e){console.error(e),t('')}}))},uid:(e=0,function(){return'u'+('0000'+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+e++}),delay:function(e){return function(t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))}},asArray:function(e){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t},escapeXhtml:function(e){return e.replace(/#/g,'%23').replace(/\n/g,'%0A')},makeImage:function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src=e}))},width:function(e){var t=n(e,'border-left-width'),r=n(e,'border-right-width');return e.scrollWidth+t+r},height:function(e){var t=n(e,'border-top-width'),r=n(e,'border-bottom-width');return e.scrollHeight+t+r}};var e;function t(e){var t=/\.([^\.\/]*?)$/g.exec(e);return t?t[1]:''}function n(e,t){var n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace('px',''))}}(),r=function(){var e=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(e,n,i){return function(){return!t(e)}()?Promise.resolve(e):Promise.resolve(e).then(r).then((function(t){var r=Promise.resolve(e);return t.forEach((function(e){r=r.then((function(t){return o(t,e,n,i)}))})),r}))},shouldProcess:t,impl:{readUrls:r,inline:o}};function t(t){return-1!==t.search(e)}function r(t){for(var r,o=[];null!==(r=e.exec(t));)o.push(r[1]);return o.filter((function(e){return!n.isDataUrl(e)}))}function o(e,t,r,o){return Promise.resolve(t).then((function(e){return r?n.resolveUrl(e,r):e})).then(o||n.getAndEncode).then((function(e){return n.dataAsUrl(e,n.mimeType(t))})).then((function(r){return e.replace(function(e){return new RegExp('(url\\([\'"]?)('+n.escape(e)+')([\'"]?\\))','g')}(t),'$1'+r+'$3')}))}}(),o=function(){return{resolveAll:function(){return e(document).then((function(e){return Promise.all(e.map((function(e){return e.resolve()})))})).then((function(e){return e.join('\n')}))},impl:{readAll:e}};function e(){return Promise.resolve(n.asArray(document.styleSheets)).then((function(e){var t=[];return e.forEach((function(e){try{n.asArray(e.cssRules||[]).forEach(t.push.bind(t))}catch(t){console.log('Error while reading CSS rules from '+e.href,t.toString())}})),t})).then((function(e){return e.filter((function(e){return e.type===CSSRule.FONT_FACE_RULE})).filter((function(e){return r.shouldProcess(e.style.getPropertyValue('src'))}))})).then((function(t){return t.map(e)}));function e(e){return{resolve:function(){var t=(e.parentStyleSheet||{}).href;return r.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue('src')}}}}}(),i=function(){return{inlineAll:function t(o){return o instanceof Element?function(e){var t=e.style.getPropertyValue('background');return t?r.inlineAll(t).then((function(t){e.style.setProperty('background',t,e.style.getPropertyPriority('background'))})).then((function(){return e})):Promise.resolve(e)}(o).then((function(){return o instanceof HTMLImageElement?e(o).inline():Promise.all(n.asArray(o.childNodes).map((function(e){return t(e)})))})):Promise.resolve(o)},impl:{newImage:e}};function e(e){return{inline:function(t){return n.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(t||n.getAndEncode).then((function(t){return n.dataAsUrl(t,n.mimeType(e.src))})).then((function(t){return new Promise((function(n,r){e.onload=n,e.onerror=r,e.src=t}))}))}}}}(),a={imagePlaceholder:void 0,cacheBust:!1},c={toSvg:s,toPng:function(e,t){return l(e,t||{}).then((function(e){return e.toDataURL()}))},toJpeg:function(e,t){return l(e,t=t||{}).then((function(e){return e.toDataURL('image/jpeg',t.quality||1)}))},toBlob:function(e,t){return l(e,t||{}).then(n.canvasToBlob)},toPixelData:function(e,t){return l(e,t||{}).then((function(t){return t.getContext('2d').getImageData(0,0,n.width(e),n.height(e)).data}))},impl:{fontFaces:o,images:i,util:n,inliner:r,options:{}}};function s(e,t){return function(e){void 0===e.imagePlaceholder?c.impl.options.imagePlaceholder=a.imagePlaceholder:c.impl.options.imagePlaceholder=e.imagePlaceholder;void 0===e.cacheBust?c.impl.options.cacheBust=a.cacheBust:c.impl.options.cacheBust=e.cacheBust}(t=t||{}),Promise.resolve(e).then((function(e){return function e(t,r,o){return o||!r||r(t)?Promise.resolve(t).then((function(e){return e instanceof HTMLCanvasElement?n.makeImage(e.toDataURL()):e.cloneNode(!1)})).then((function(e){return i(t,e,r)})).then((function(e){return function(e,t){return t instanceof Element?Promise.resolve().then(r).then(o).then(i).then(a).then((function(){return t})):t;function r(){var r,o;r=window.getComputedStyle(e),o=t.style,r.cssText?o.cssText=r.cssText:function(e,t){n.asArray(e).forEach((function(n){t.setProperty(n,e.getPropertyValue(n),e.getPropertyPriority(n))}))}(r,o)}function o(){[':before',':after'].forEach((function(r){!function(r){var o=window.getComputedStyle(e,r),i=o.getPropertyValue('content');if(''===i||'none'===i)return;var a=n.uid();t.className=t.className+' '+a;var c=document.createElement('style');c.appendChild(function(e,t,r){var o='.'+e+':'+t,i=r.cssText?function(e){var t=e.getPropertyValue('content');return e.cssText+' content: '+t+';'}(r):function(e){return n.asArray(e).map((function(t){return t+': '+e.getPropertyValue(t)+(e.getPropertyPriority(t)?' !important':'')})).join('; ')+';'}(r);return document.createTextNode(o+'{'+i+'}')}(a,r,o)),t.appendChild(c)}(r)}))}function i(){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function a(){t instanceof SVGElement&&(t.setAttribute('xmlns','http://www.w3.org/2000/svg'),t instanceof SVGRectElement&&['width','height'].forEach((function(e){var n=t.getAttribute(e);n&&t.style.setProperty(e,n)})))}}(t,e)})):Promise.resolve();function i(t,r,o){var i=t.childNodes;return 0===i.length?Promise.resolve(r):a(r,n.asArray(i),o).then((function(){return r}));function a(t,n,r){var o=Promise.resolve();return n.forEach((function(n){o=o.then((function(){return e(n,r)})).then((function(e){e&&t.appendChild(e)}))})),o}}}(e,t.filter,!0)})).then(u).then(d).then((function(e){t.bgcolor&&(e.style.backgroundColor=t.bgcolor);t.width&&(e.style.width=t.width+'px');t.height&&(e.style.height=t.height+'px');t.style&&Object.keys(t.style).forEach((function(n){e.style[n]=t.style[n]}));return e})).then((function(r){return function(e,t,r){return Promise.resolve(e).then((function(e){return e.setAttribute('xmlns','http://www.w3.org/1999/xhtml'),(new XMLSerializer).serializeToString(e)})).then(n.escapeXhtml).then((function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+'</foreignObject>'})).then((function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+r+'">'+e+'</svg>'})).then((function(e){return'data:image/svg+xml;charset=utf-8,'+e}))}(r,t.width||n.width(e),t.height||n.height(e))}))}function l(e,t){return s(e,t).then(n.makeImage).then(n.delay(100)).then((function(r){var o=function(e){var r=document.createElement('canvas');if(r.width=t.width||n.width(e),r.height=t.height||n.height(e),t.bgcolor){var o=r.getContext('2d');o.fillStyle=t.bgcolor,o.fillRect(0,0,r.width,r.height)}return r}(e);return o.getContext('2d').drawImage(r,0,0),o}))}function u(e){return o.resolveAll().then((function(t){var n=document.createElement('style');return e.appendChild(n),n.appendChild(document.createTextNode(t)),e}))}function d(e){return i.inlineAll(e).then((function(){return e}))}e.exports=c}()},function(e,t,n){var r=n(4);e.exports=function(e,t){if(null==e)return{};var n,o,i=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),i=n(2),a=n.n(i),c=n(0),s=n.n(c);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.default=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=u(u({},{dbName:'gjs',objectStoreName:'templates',indexeddbVersion:4,addOnUpgrade:0,defaultPage:'Default',defaultTemplate:'Blank',blankTemplate:{id:'Blank',template:!0,'gjs-html':'','gjs-css':''},onDelete:function(e){return console.log('Deleted:',e)},onDeleteError:function(e){return console.log(e)},onScreenshotError:function(e){return console.log(e)},quality:.005}),n),i=r.defaultPage||"Default",a="",c=r.defaultTemplate||"Blank",l=!1,d='',f=document.querySelectorAll.bind(document),p=e.Commands,g=e.Modal,m=e.StorageManager,h='indexeddb',v=r.objectStoreName,y=function(){return m.getConfig().id||'gjs-'},b=function(){return i},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;s.a.toJpeg(e,t).then((function(e){return n&&n(e)})).catch((function(e){return r&&r(e)}))};e.domtoimage=s.a;var j=function(){return t},P=function(e){if(t)e(t);else{var n=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(r.dbName,r.indexeddbVersion),o=function(){return m.onError(h,n.errorCode)};n.onerror=o,n.onsuccess=function(){(t=n.result).onerror=o,e(t)},n.onupgradeneeded=function(e){e.currentTarget.result.createObjectStore(v,{keyPath:'id'}),r.addOnUpgrade&&r.addOnUpgrade.forEach((function(e){S((function(t){t.put(u({id:e.id,template:e.template},e))}))}))}}},x=function(){return t.transaction([v],'readwrite').objectStore(v)},S=function(e){t?e(x()):P((function(t){return e(x())}))};m.add(h,{getDb:j,getObjectStore:x,load:function(e,t,n){S((function(e){var r=e.get(i);r.onerror=n,r.onsuccess=function(){var e=r.result||{},n=(e.id,e.template,o()(e,["id","template"]));t(n)}}))},loadAll:function(e,t){S((function(n){var r=n.getAll();r.onerror=t,r.onsuccess=function(){e(r.result)}}))},store:function(e,t,n){S((function(r){var o=r.put(u({id:i,template:l,thumbnail:d},e));o.onerror=n,o.onsuccess=t}))},delete:function(e,t){S((function(n){var r=n.delete(i);r.onerror=t,r.onsuccess=e}))}});var E=function(e,t){return"<div class=\"gjs-templates-card\" data-id=\"".concat(e,"\">\n      ").concat(t,"\n    </div>")},O=function(e){return"<div class=\"gjs-templates-card-2\">\n      ".concat(e,"\n    </div>")},T=function(e){return"<div id=\"templates\" class=\"gjs-templates gjs-one-bg gjs-two-color\">\n      <div class=\"gjs-templates-overlay\"></div>\n      <div class=\"gjs-templates-cont\">\n        <div class=\"gjs-fonts\">\n          <label style=\"font-size: 0.9rem;font-family: Arial, Helvetica, sans-serif; display: block;\" for=\"page-name\">Name</label>\n          <div style=\"width: 50%; display: inline-block;\" class=\"gjs-field\">\n            <input style=\"border: 1px solid rgba(0, 0, 0, 0.2);\n              border-radius: 5px;\n              font-family: Arial, Helvetica, sans-serif;\" type=\"text\" name=\"pageName\" id=\"page-name\">\n          </div>\n          <span style=\"display: inline-block;\">\n            <button class=\"gjs-btn-prim\" style=\"padding: 10px;\n            border-radius: 3px;\n            font-size: 0.9rem;\n            margin-left: 220px;\" id=\"template-edit\">Edit Selected</button>\n          </span>\n          <span style=\"display: inline-block;\">\n            <button class=\"gjs-btn-prim\" style=\"padding: 10px;\n              border-radius: 3px;\n              font-size: 0.9rem;\n              margin-left: 10px;\" id=\"page-create\">Create</button>\n          </span>\n        </div>\n        <div class=\"gjs-templates-header2\">\n          Templates\n        </div>\n        ".concat(e,"\n      </div>\n    </div>")},A=function(e){return"<div id=\"pages\" class=\"gjs-templates gjs-one-bg gjs-two-color\">\n    <div class=\"gjs-templates-overlay\"></div>\n    <div class=\"gjs-templates-cont\">\n      <div class=\"gjs-templates-header2\">\n        Your Pages\n      </div>\n      ".concat(e,"\n      </div>\n    </div>")},C=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n='';return e.forEach((function(e){var r="<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"template-preview\" viewBox=\"0 0 1300 1100\" width=\"99%\" height=\"220\">\n        <foreignObject width=\"100%\" height=\"100%\" style=\"pointer-events:none\">\n          <div xmlns=\"http://www.w3.org/1999/xhtml\" ".concat(e[y()+'html']?'':'padding-top:100%',"\">\n          ").concat(e[y()+'html']+'<style scoped>'+e[y()+'css']+'</style>',"\n          </div>\n        </foreignObject>\n      </svg>"),o=e.thumbnail?"<div style=\"display:flex;height:219px;overflow:hidden\">\n          <img class=\"template-preview\" src=\"".concat(e.thumbnail,"\" alt=\"").concat(e.id,"\">\n        </div>\n        <div class=\"label\">").concat(e.id,"</div>"):"".concat(r,"<div class=\"label\">").concat(e.id,"</div>");t?e.template&&(n+=E(e.id,o)):!e.template&&(n+=E(e.id,o))})),t?T(O(n)):A(O(n))};p.add('open-templates',{run:function(e,t){var n=document.querySelector('.gjs-mdl-dialog');n.classList.add("gjs-mdl-dialog-tml"),t&&t.set&&t.set('active'),g.setTitle('<div style="font-size: 1rem">Create Page</div>'),g.setContent('<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'),e.Storage.get('indexeddb').loadAll((function(t){g.setContent(C(t)),f('.gjs-templates-card').forEach((function(e){return e.dataset.id==c&&e.classList.add('gjs-templates-card-active')})),f('#page-name')[0].addEventListener('keyup',(function(e){return a=e.currentTarget.value})),f('#page-create')[0].addEventListener('click',(function(t){i=c,l=!1,a&&e.load((function(t){e.setComponents(t.components?JSON.parse(t.components):t.html),e.setStyle(t.styles?JSON.parse(t.styles):t.css),d=t.thumbnail||'',i=a,g.close()}))})),f('#template-edit')[0].addEventListener('click',(function(t){i=c,l=!0,e.load((function(t){e.setComponents(t.components?JSON.parse(t.components):t.html),e.setStyle(t.styles?JSON.parse(t.styles):t.css),d=t.thumbnail||'',g.close()}))})),f('.gjs-templates-card').forEach((function(e){e.addEventListener('click',(function(t){c=t.currentTarget.dataset.id,f('.gjs-templates-card').forEach((function(e){return e.classList.remove('gjs-templates-card-active')})),e.classList.add('gjs-templates-card-active')}))}))}),(function(e){return console.log("Error",e)})),g.open(),g.getModel().once('change:open',(function(){document.querySelector('.gjs-mdl-collector').innerHTML="",n.classList.remove("gjs-mdl-dialog-tml")}))}}),p.add('open-pages',{run:function(e,t){var n=document.querySelector('.gjs-mdl-dialog');n.classList.add("gjs-mdl-dialog-tml"),t&&t.set&&t&&t.set('active'),g.setTitle('<div style="font-size: 1rem">Select Page</div>'),g.setContent('<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'),e.Storage.get('indexeddb').loadAll((function(t){g.setContent(C(t,!1)),f('.gjs-templates-card').forEach((function(e){return e.dataset.id==i&&e.classList.add('gjs-templates-card-active')})),f('.gjs-templates-card').forEach((function(t){t.addEventListener('click',(function(t){i=t.currentTarget.dataset.id,l=!1,e.load((function(t){e.setComponents(t.components?JSON.parse(t.components):t.html),e.setStyle(t.styles?JSON.parse(t.styles):t.css),d=t.thumbnail||'',g.close()}))}))}))}),(function(e){return console.log("Error",e)})),g.open(),g.getModel().once('change:open',(function(){document.querySelector('.gjs-mdl-collector').innerHTML="",n.classList.remove("gjs-mdl-dialog-tml")}))}}),p.add('save-as-template',{run:function(e,t){l=!0,e.store()}}),p.add('delete-from-idb',{run:function(e,t){e.Storage.get('indexeddb').delete((function(e){return r.onDelete(e)}),(function(e){return r.onDeleteError(e)})),e.Commands.run('open-pages')}}),p.add('take-screenshot',{run:function(e,t){var n=e.getWrapper().getEl();w(n,{quality:r.quality,height:1e3,cacheBust:!0,style:{'background-color':n.style.backgroundColor||'white'}},(function(t){d=t,e.store()}),(function(e){return r.onScreenshotError(e)}))}}),p.add('get-current-id',{run:function(e,t){return b()}}),e.on('storage:load',(function(e){return d=e.thumbnail||''})),e.on('load',(function(){r.blankTemplate&&S((function(e){var t=e.get(r.blankTemplate.id);t.onsuccess=function(){!t.result&&e.put(r.blankTemplate)}}))}))}},function(e,t){e.exports=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}}])}));
//# sourceMappingURL=grapesjs-indexeddb-ui.min.js.map